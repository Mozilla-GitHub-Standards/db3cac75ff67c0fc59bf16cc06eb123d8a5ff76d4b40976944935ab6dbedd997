%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 
%% Informal notes on k-randomization.
%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\documentclass[11pt,draft]{article}
%\documentclass[11pt,draft]{amsart}

%% Custom styling.
\usepackage{mozdp}
%% Controls enumeration labels
%\usepackage{enumerate}
%% Shrinks margins 
\usepackage{fullpage}
%% Shows equation label keys
%\usepackage[notref]{showkeys}

%% Some convenience aliases.
\newcommand{\Dsp}{\mathcal{D}}
\newcommand{\Ssp}{\mathcal{S}}
\newcommand{\xv}{\mathbf{x}}
\newcommand{\yv}{\mathbf{y}}
\newcommand{\sv}{\mathbf{s}}
\newcommand{\xvt}{\tilde{\xv}}
\newcommand{\sm}{\sv^-}
\newcommand{\iv}{\mathbf{i}}

%% Title matter
\title{K-Randomization}
\author{Maxim Zhilyaev \and David Zeber}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
\maketitle

\section{Differential Privacy}
\label{sec:dp}

The typical setting for differential privacy is as follows. 
We consider a \textbf{database} as a collection of records. 
Each record is an element of some space $\Dsp$, and a database $\xv$ is a vector of $n$ records: $\xv = (x_1,\dots,x_n) \in \Dsp^n$.

We wish to release information retrieved from the database by means of a \textbf{query}, a function $A$ mapping the database into another space: $\map{A}{\Dsp^n}{\Ssp}$. The result of applying a query to a database is termed a \textbf{transcript}.
The query usually applies some aggregation to the database records, and so the output space $\Ssp$ is generally of lower dimensionality than the original database.
If the query is randomized, \ie $A(\xv) = A(\xv; \xi)$ for a random element $\xi$, then the transcript will be a random element of $\Ssp$.

The notion of differential privacy for a database query is that the resulting transcript does not change substantially when a record in the database is modified,
\ie transcripts are not sensitive to particular individual records in the database.
Hence, releasing query transcripts publicly will not jeopardize privacy, since information regarding individual records cannot be gained by analyzing query transcripts.

%%% Differential privacy definition

Differential privacy for a randomized query $A$ is formulated by comparing the transcripts generated by applying $A$ to two very similar databases $\xv,\xv' \in \Dsp^n$.
We say the databases \textbf{differ in one row} if 
$\sum_{i=1}^n I(x_i \neq x'_i) = 1$.
\begin{defn}
A randomized query $A$ is $\epsilon$-\textbf{differentially private} if, 
for any two databases $\xv,\xv' \in \Dsp^n$ differing in one row,
\begin{equation}\label{eq:dpdef}
\P[A(\xv) \in S] \leq \exp(\epsilon) \cdot \P[A(\xv') \in S]
\end{equation}
for all $S \cont \Ssp$ (measurable).
\end{defn}
In other words, the transcripts from the two databases databases differing in one row are close in distribution.
An alternative notion of differing in one row that is sometimes used is that $\xv'$ includes an additional record that is not in $\xv$:
$\xv\in \Dsp^n$, $\xv' \in \Dsp^{n+1}$, and $x_i = x'_i$ for $i = 1,\dots,n$.

%%% Countable output space

%% TODO: countable vs. finite
%% TODO: Lemma for bounding ratio of sums

If $\Ssp$ is finite, which is common in cases where the transcript involves integer counts, then the distribution of the transcript $A(\xv)$ can be represented using its pmf $\P[A(\xv) = s]$ for $s \in \Ssp$.
In this case, the differential privacy condition can also be expressed in terms of the pmf.
\begin{prop} \label{prop:dpcnt}
If $\Ssp$ is finite, then $A$ is $\epsilon$-\textbf{differentially private} if and only if
\begin{equation} \label{eq:dpcnt}
\P[A(\xv) = s] \leq \exp(\epsilon) \cdot \P[A(\xv') = s]
\end{equation}
for all $s\in\Ssp$, where $\xv,\xv'$ differ in one row.
\end{prop}
\begin{pf}
\pfleftdir
Given $S \cont \Ssp$, we can write
$\P[A(\xv) \in S] = \sum_{s \in S} \P[A(\xv) = s]$.
If $\P[A(\xv') \in S] = 0$, then $\P[A(\xv') = s] = 0$ for each $s \in S$.
From \eqref{eq:dpcnt} we have that $\P[A(\xv) = s] = 0$ as well, and so $P[A(\xv) \in S] = 0$, verifying \eqref{eq:dpdef}.
Otherwise, if $\P[A(\xv') \in S] > 0$,
\[ \frac{\P[A(\xv) \in S]}{\P[A(\xv') \in S]}
= \frac{\sum_{s \in S} \P[A(\xv) = s]}{\sum_{s \in S} \P[A(\xv') = s]}
\leq \max_{s \in S} \frac{\P[A(\xv) = s]}{\P[A(\xv') = s]}
\leq \exp(\epsilon), \]
using Lemma \ref{lem:rsbound}.\\
\pfrightdir Take $S = \{s\}$ in \eqref{eq:dpdef}.
\end{pf}



\section{Bit vector reporting}

Our goal is to establish differential privacy properties for user data reported in the form of vectors of bits.
To protect user privacy, each user record is randomized prior to leaving the client and anonymized on reaching the server.
We now describe the randomization procedure, and place ourselves in the setting of Section \ref{sec:dp} by representing it as a query applied to a database.


\subsection{Bit randomization}

For our purposes, a \textbf{bit} is an integer $b \in \{0,1\}$, and a \textbf{bit vector} is a vector $x \in \{0,1\}^L$.
Bits and bit vectors are randomized in the following way.

\begin{defn}
The \textbf{bit randomization} procedure $R$ with \textbf{lie probability} $0 < q < 1/2$ flips a bit $b$ with probability $q$, and leaves it as-is with probability $p := 1-q$:
\[ R(b) =
\begin{cases}
b & \text{with prob }p \\
1-b & \text{with prob }q
\end{cases}.
\]
This can be expressed concisely as
\[ R(b) = R(b; \xi) = b \cdot \xi + (1-b) \cdot (1-\xi)
\quad\text{where } \xi\sim Ber(p). \]
We extend the procedure to \textbf{bit vector randomization} by applying the randomization independently to each bit in the vector.
Given a bit vector $x = (b_1,\dots,b_L)$, define
\[ R(x) = R(x;\xi) = \big(R(b_1;\xi_1), \dots, R(b_L;\xi_L)\big)
\quad\text{where } \xi = (\xi_1,\dots,\xi_L) \iid Ber(p). \]
\end{defn}

\begin{rmk}
Note that $R$ reports the original bit value with probability $p = 1-q > q$, and lies with probability $q$.
This is equivalent to the randomized response procedure where the value is reported as-is with probability $1-f$, and with probability $f$ the reported value is the outcome of the toss of a fair coin.
In our case, $q = f/2$.
\end{rmk}
\begin{rmk}
If $q = 1/2$, then $R(0)\eqdist R(1)$, and the reported value is ``completely'' randomly generated, \ie independently of the original value.
\end{rmk}

%%% Distribution of randomized bit vectors.

We now consider the distribution of the randomized bit vectors.
It can be expressed in terms of the Hamming distance between the original and randomized vectors:
\[ \delta(x,x') = \sum_{\ell = 1}^L I(x_\ell \neq x'_\ell)
= \sum_{\ell = 1}^L |x_\ell - x'_\ell|. \]
For a single bit, the randomization has lied when the outcome is different from the original value: 
\[ \P[R(b) = y] = p^{I(b = y)}\cdot q^{I(b \neq y)}
= (1-q)^{1 - \delta(b,y)}\cdot q^{\delta(b,y)}. \]
For a bit vector $x$, this becomes
\[ \P[R(x) = y] = p^{\sum I(x_\ell = y_\ell)}\cdot q^{\sum I(x_\ell \neq y_\ell)}
= (1-q)^{L-\delta(x,y)}\cdot q^{\delta(x,y)}.
\]
Note that this probability is maximized when $\delta(x,y) = 0$ (the randomized vector $y$ is identical to the original vector $x$), and minimized when $\delta(x,y) = L$.
In the latter case, we say that $y$ is the \textbf{opposite} of $x$.
In other words, the most likely outcome of randomizing a bit vector is obtaining an identical vector.

\subsection{Reporting for bit records}

We now place ourselves in the setting of Section \ref{sec:dp} for bit-vector user records, as required in the sequel.

Set $\Dsp = \{0,1\}^L$. We use the term \textbf{collection} (of records) interchangeably with ``database''.
We consider a randomized query $A$ that randomizes each record in the collection independently, and aggregates the results by reporting occurrence counts for every possible randomization outcome.
We adopt this aggregation step as a model for anonymization. After anonymization, any link to the original collection or ordering is lost, and the information contained in the results is embodied solely by the reported values.

In the following, we rely on the fact that $\Dsp$ is finite, and we assume a specific enumeration $\Dsp = (d_1,\dots,d_{2^L})$. The ordering is unimportant at this point, although it will be convenient to assume that $d_1 =  (1,\dots,1)$ and $d_{2^L} = (0,\dots,0)$.

\begin{defn}
The randomized query $\map{A}{\Dsp^n}{\Ssp = \{0,\dots,n\}^{2^L}}$ maps collections of bit vectors to occurrence counts as follows.
\begin{enumerate}
\renewcommand{\labelenumi}{(\alph{enumi})}
\item Extend the bit randomization $R$ to collections $\xv$ by applying it independently to each vector:
\[ R(\xv) = R(\xv;\boldsymbol{\xi})
= \big(R(x_1;\xi_1),\dots,R(x_n; \xi_n)\big)
\quad\text{where } \xi_i = (\xi_{i1},\dots,\xi_{iL}) \text{ and }
\xi_{i\ell} \iid Ber(p). \]
We call $R(\xv)$ the \textbf{synthetic} collection obtained from the \textbf{original} collection $\xv$.
\item Define the function $\Phi$ that counts occurrences of the elements of $\Dsp = (d_1,\dots,d_{2^L})$ in a collection $\yv$:
\[ \Phi(\yv) := \left(\sum_{i = 1}^n I(y_i = d_1),\dots,
\sum_{i = 1}^n I(y_i = d_{2^L}).
\right)
\]
Note that, if $\Phi(\yv) = (s_1,\dots,s_{2^L})$, then $s_1 + \cdots + s_{2^L} = n$.
\end{enumerate}
Finally,
\[ A  = \Phi \circ R. \]
\end{defn}

The distribution of $A(\xv)$ is given by
\begin{align}
\P[A(\xv) = \sv] &= \P[\Phi(R(\xv)) = s]
= \sum_{\yv:\Phi(\yv) = s} \P[R(\xv) = \yv] \nonumber\\
&= \sum_{\yv:\Phi(\yv) = s} \prod_{i=1}^n \P[R(x_i) = y_i]
\label{eq:Adist}\\
&= \sum_{\yv:\Phi(\yv) = s} \prod_{i=1}^n p^{L - \delta(x_i,y_i)}\cdot
q^{\delta(x_i,y_i)}
= \sum_{\yv:\Phi(\yv) = s} p^{nL - \delta(\xv,\yv)}\cdot
q^{\delta(\xv,\yv)}  \nonumber
\end{align}
Note that the support of $A$ is the support of a multinomial rv with $n$ trials: \[\Ssp_n := \bigg\{s \in \Ssp : \sum_j s_j = n \bigg\}.\]

\section{Maximal collections}

We will study the differential privacy of the query $A$ in terms of the \textbf{privacy ratio}
\[ \pi(\sv,\xv,\xv') := \frac{\P[A(\xv') = \sv]}{\P[A(\xv) = \sv]} \]
for two collections $\xv,\xv'\in\Dsp^n$ differing in one row and $\sv \in\Ssp_n$.
Note that $\pi$ is well-defined, since any outcome in $\Ssp_n$ occurs with non-zero probability starting from any collection $\xv$.
By Proposition \ref{prop:dpcnt}, $A$ is $\epsilon$-differentially private if $\pi$ is bounded everywhere on $\Ssp$,
with $\epsilon = \max_{\xv,\xv' \in \Dsp^n;\,\sv\in\Ssp} \log\pi$.

Without loss of generality (in light of \eqref{eq:Adist}), assume that the element differing between $\xv$ and $\xv'$ is the first one, and denote $\xvt = (x_2,\dots,x_n)$.
In other words, $\xv = (x_1,\xvt)$ and $\xv' = (x'_1, \xvt)$.
We also write $\iv_j = (0,\dots,0,1,0,\dots,0)$, the vector with a 1 in the $j$-th position and the rest 0.
%For convenience, introduce the notation
%$\sm_j = (s_1,\dots,s_{j-1},s_j - 1,s_{j+1},\dots,s_{2^L})$.

Conditioning on its value, we can write
\begin{equation} \label{eq:prcond}
\pi(\sv,\xv,\xv') = \frac{\displaystyle\sum_{j=1}^{2^L}
\P[A(x'_1) = \iv_j] \P[A(\xvt) = \sv - \iv_j]}
{\displaystyle\sum_{j=1}^{2^L}
\P[A(x_1) = \iv_j] \P[A(\xvt) = \sv - \iv_j]}
= \frac{\displaystyle\sum_{j=1}^{2^L}
\P[R(x'_1) = d_j] \P[A(\xvt) = \sv - \iv_j]}
{\displaystyle\sum_{j=1}^{2^L}
\P[R(x_1) = d_j] \P[A(\xvt) = \sv - \iv_j]},
\end{equation}
implying that $\pi$ only depends on the modified collection through the modified record: $\pi = \pi(\sv,\xv,x_1')$.

TODO: consequences of this: \\
- difference between numerator and denominator is basically a reweighting of the same terms in the sum \\
- max value of ratio

The first question we address is for which pair of original and modified collections $\xv$ and $\xv'$ does $\pi$ obtain its maximum.

\subsection{The case $L = 1$}

It is instructive to first consider the case where each record in the collection consists of a single bit, as the expressions simplify considerably.
In this case, the outcome of $A$ essentially reduces to the number of 1s obtained in the synthetic collection $R(\xv)$, since $\sv\in\Ssp_n$ can be written as $(s_1,s_2)$ with $s_1\in\{0,\dots,n\}$ and $s_2 = n-s_1$. 
Using this fact, we interpret $A(\xv)$ as $\sum_{i=1}^n I(R(x_i) = 1)$,
and express the privacy ratio as
\[ \pi(s,\xv,x_1') = \frac{\P[R(x'_1) = 1] \P[A(\xvt) = s-1] +
\P[R(x'_1) = 0] \P[A(\xvt) = s]}
{\P[R(x_1) = 1] \P[A(\xvt) = s-1] + \P[R(x_1) = 0] \P[A(\xvt) = s]}
\]
for $s \in \{0,\dots,n\}$. Furthermore, the requirement that $x_1 \neq x'_1$ in the single-bit case implies that $x'_1 = 1-x_1$, so
\[ \pi(s,\xv,x_1') = \frac{(1-\P[R(x_1) = 1]) \P[A(\xvt) = s-1] +
(1-\P[R(x_1) = 0]) \P[A(\xvt) = s]}
{\P[R(x_1) = 1] \P[A(\xvt) = s-1] + \P[R(x_1) = 0] \P[A(\xvt) = s]}.
\]
%Hence, $\pi(s; x_1 = 0) = 1/\pi(s; x_1 = 1)$, and so 
%\[ \max_{\xv,\xv';\,\sv} \pi = \max\left(\max_{\xvt;\,s} \pi(s;x_1 = 1),\, \max_{\xvt;\,s} \pi(s;x_1 = 0)\right)
%=  \max\left(\max_{\xvt;\,s} \pi(s;x_1 = 1),\, \min_{\xvt;\,s} \pi(s;x_1 = 1)\right)
%\]
We fix $s$ and investigate which choice of collection $\xv = (x_1,\xvt)$ maximizes $\pi(s,\xv,x_1')$.
Assume first $x_1 = 1$. (TODO: what about when $x_1 = 0$?) Then
\[ \pi(s,\xvt,0) = \frac{q \P[A(\xvt) = s-1] + p \P[A(\xvt) = s]}
{p \P[A(\xvt) = s-1] + q \P[A(\xvt) = s]}.
\]

\section{Ratios of sums: properties}

Here we establish some results around bounding and comparing ratios of sums, which will be useful in working with the privacy ratio.

%%% Bounding ratio of sums by max ratio of terms

\begin{lem} \label{lem:rsbound}
Suppose $a_1,\dots,a_m,b_1,\dots,b_m \in \R$ with $b_i > 0$ all $i$.
Then 
\[ \frac{a_1 + \cdots + a_m}{b_1 + \cdots + b_m} \leq
\max\left(\frac{a_1}{b_1},\dots,\frac{a_m}{b_m}\right). \]
\end{lem}
\begin{pf}
Write
\[ \frac{a_1 + \cdots + a_m}{b_1 + \cdots + b_m}
= \frac{a_1}{b_1}\frac{b_1}{b_1+\cdots+b_m} +
%\frac{a_2}{b_2}\frac{b_2}{b_1+\cdots+b_m} +
\cdots + \frac{a_m}{b_m}\frac{b_m}{b_1+\cdots+b_m} =
\sum_{i=1}^m \frac{a_i}{b_i} \lambda_i
\]
where $\lambda_1 + \cdots + \lambda_m = 1$.
The result follows since each $a_i/b_i$ is bounded by $\max_i a_i/b_i$.
\end{pf}

%%% Comparing ratios of sums by comparing ratios of terms

%\begin{lem} \label{lem:rscomp}
%Suppose $a_i,b_i,a'_i,b'_i > 0$ for $i=1,\dots,m$.
%Then
%\begin{equation} \label{eq:rscomp}
%\frac{a_1 + \cdots + a_m}{b_1 + \cdots + b_m} \geq
%\frac{a'_1 + \cdots + a'_m}{b'_1 + \cdots + b'_m}
%\end{equation}
%if
%\begin{equation} \label{eq:lambdamucond}
%a_i/b_i \geq  a_j/b_j,\quad a'_i/b'_i \geq a'_j/b'_j
%\end{equation}
%and
%\begin{equation} \label{eq:aapcond}
%a_i/a_j \geq a'_i/a'_j,\quad b_i/b_j \geq b'_i/b'_j
%\end{equation}
%whenever $1 \leq i < j \leq m$.
%\end{lem}
%It is easy to see that \eqref{eq:lambdamucond} is satisfied when
%$a_1 \geq a_2 \geq \cdots \geq a_m$ and $b_1 \leq b_2 \leq \cdots \leq b_m$, and analogously for $a'$ and $b'$.
%It is also clear from the proof that \eqref{eq:rscomp} still holds if all the inequalities in \eqref{eq:lambdamucond} and \eqref{eq:aapcond} are reversed.
%\begin{pf}
%Cross-multiplying, we see that \eqref{eq:rscomp} is equivalent to
%\[ \sum_i \sum_j a_i b'_j \geq \sum_i \sum_j a'_i b_j \iff
%\sum_i \sum_{j \neq i} (a_ib'_j - a'_ib_j) \geq 0.
%\]
%Furthermore,
%\begin{align*}
%\sum_i \sum_{j \neq i} (a_ib'_j - a'_ib_j)
%&= \sum_i \sum_{j > i} (a_ib'_j - a'_ib_j) +
%\sum_i \sum_{j < i} (a_ib'_j - a'_ib_j) \\
%%% relabel the indices
%&= \sum_i \sum_{j > i} a_i a'_j (\lambda_i\mu_j - \lambda_j\mu_i) +
%\sum_j \sum_{i < j} a_j a'_i (\lambda_j\mu_i - \lambda_i\mu_j) \\
%%% reverse the sums
%&= \sum_i \sum_{j > i} a_i a'_j (\lambda_i\mu_j - \lambda_j\mu_i) +
%\sum_i \sum_{j > i} a_j a'_i (\lambda_j\mu_i - \lambda_i\mu_j) \\
%%% factor out -1 from the second term and combine
%&= \sum_i \sum_{j > i} (a_i a'_j - a_j a'_i)(\lambda_i\mu_j - \lambda_j\mu_i),
%\end{align*}
%where the second equality follows from relabeling the summation indices, and the third from reversing the sums.
%It follows that \eqref{eq:rscomp} will hold if
%$(a_i a'_j - a_j a'_i)(\lambda_i\mu_j - \lambda_j\mu_i) \geq 0$ for all  $1 \leq i < j \leq m$, which is implied by \eqref{eq:lambdamucond} and \eqref{eq:aapcond}.
%\end{pf}


%%%%%%%%%%%%%%%%%%%%

\begin{lem} \label{lem:rscomp2}
Suppose $a_i,a'_i,\lambda_i,\mu_i > 0$ for $i=1,\dots,m$.
Then
\begin{equation} \label{eq:rscomp2}
\frac{a_1\lambda_1 + \cdots + a_m\lambda_m}
{a_1\mu_1 + \cdots + a_m\mu_m} \geq
\frac{a'_1\lambda_1 + \cdots + a'_m\lambda_m}
{a'_1\mu_1 + \cdots + a'_m\mu_m}
\end{equation}
if
\begin{equation} \label{eq:lambdamucond2}
\lambda_i/\mu_i \geq  \lambda_j/\mu_j
% \frac{\lambda_i}{\mu_i} \geq \frac{\lambda_j}{\mu_j}
%\quad\quad\text{and}\quad\quad \frac{a_i}{a_j} \geq \frac{a'_i}{a'_j}
\end{equation}
and
\begin{equation} \label{eq:aapcond2}
a_i/a_j \geq a'_i/a'_j
\end{equation}
whenever $1 \leq i < j \leq m$.
\end{lem}
Note that numerator and denominator have the same index \eqref{eq:lambdamucond2}, and different indices in \eqref{eq:aapcond2}.
It is easy to see that \eqref{eq:lambdamucond2} is satisfied when
$\lambda_1 \geq \lambda_2 \geq \cdots \geq \lambda_m$ and
$\mu_1 \leq \mu_2 \leq \cdots \leq \mu_m$.
It is also clear from the proof that \eqref{eq:rscomp2} still holds if all the inequalities in \eqref{eq:lambdamucond2} and \eqref{eq:aapcond2} are reversed.
\begin{pf}
Cross-multiplying, we see that \eqref{eq:rscomp2} is equivalent to
\[ \sum_i \sum_j a_i a'_j \lambda_i \mu_j \geq
\sum_i \sum_j a_i a'_j \lambda_j \mu_i \iff
\sum_i \sum_{j \neq i} a_i a'_j (\lambda_i\mu_j - \lambda_j\mu_i) \geq 0.
\]
Furthermore,
\begin{align*}
\sum_i \sum_{j \neq i} a_i a'_j (\lambda_i\mu_j - \lambda_j\mu_i)
&= \sum_i \sum_{j > i} a_i a'_j (\lambda_i\mu_j - \lambda_j\mu_i) +
\sum_i \sum_{j < i} a_i a'_j (\lambda_i\mu_j - \lambda_j\mu_i) \\
%% relabel the indices
&= \sum_i \sum_{j > i} a_i a'_j (\lambda_i\mu_j - \lambda_j\mu_i) +
\sum_j \sum_{i < j} a_j a'_i (\lambda_j\mu_i - \lambda_i\mu_j) \\
%% reverse the sums
&= \sum_i \sum_{j > i} a_i a'_j (\lambda_i\mu_j - \lambda_j\mu_i) +
\sum_i \sum_{j > i} a_j a'_i (\lambda_j\mu_i - \lambda_i\mu_j) \\
%% factor out -1 from the second term and combine
&= \sum_i \sum_{j > i} (a_i a'_j - a_j a'_i)(\lambda_i\mu_j - \lambda_j\mu_i),
\end{align*}
where the second equality follows from relabeling the summation indices, and the third from reversing the sums.
It follows that \eqref{eq:rscomp2} will hold if
$(a_i a'_j - a_j a'_i)(\lambda_i\mu_j - \lambda_j\mu_i) \geq 0$ for all  $1 \leq i < j \leq m$, which is implied by \eqref{eq:lambdamucond2} and \eqref{eq:aapcond2}.
\end{pf}

\section{Old stuff}


%%% Independent randomization/RAPPOR form of DP

%% To prove in general (for sets other than measurable rectangles, represent
%% probability as an iterated integral over sections - only one will be different.

Furthermore, if $A$ randomizes each record in the database independently,
\ie $A(\boldsymbol{x}) = A(\boldsymbol{x}, \boldsymbol{X}) := 
\big(A_0(x_1, X_1),\dots,A_0(x_n,X_n)\big)$
where $X_i$ are independent,
then $\boldsymbol{S} = \boldsymbol{S}_0^n$ and $s = (s_1,\dots,s_n)$ with 
$s_i \in \boldsymbol{S}_0$. 
In this case
$P[A(\boldsymbol{x}) = s] = P[A_0(x_1) = s_1,\dots,A_0(x_n) = s_n]
= \prod P[A_0(x_i) = s_i]$.
If $\boldsymbol{x}$ and $\boldsymbol{x'}$ differ in one row (wlog $x_1 \neq x'_1$ and $x_i = x'_i$ for $i = 2,\dots,n$),
then
\[ \frac{P[A(\boldsymbol{x}) = s]}{P[A(\boldsymbol{x'}) = s]} = 
\frac{P[A_0(x_1) = s_1]}{P[A_0(x'_1) = s_1]}. \]
Therefore, in this case, the query $A$ will satisfy differential privacy if
\[ P[A_0(x) = s] \leq \epsilon \cdot P[A_0(x') = s] \]
for all $x,x' \in D$ and $s \in \boldsymbol{S}_0$.
This is the formulation used in the RAPPOR paper that applies to differences between individual records rather than collections differing on a single element.




\end{document}















